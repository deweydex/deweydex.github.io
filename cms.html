<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Manager - Edit Mode</title>
    <link rel="stylesheet" href="style.css">
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- GitHub Connection Banner -->
    <div class="github-banner" id="githubBanner">
        <div class="banner-content">
            <i class="fab fa-github"></i>
            <span id="bannerText">Not connected to GitHub</span>
            <button class="btn-banner" id="connectGithubBtn">Connect to GitHub</button>
        </div>
    </div>

    <!-- Floating Sidebar Toggle (appears when sidebar is collapsed) -->
    <button class="floating-sidebar-toggle" id="floatingSidebarToggle" style="display: none;">
        <i class="fas fa-bars"></i>
    </button>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üìù Content Manager</h1>
                <button class="btn-icon" id="toggleSidebar" title="Toggle Sidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="sidebar-actions">
                <button class="btn-primary" id="newPageBtn">
                    <i class="fas fa-plus"></i> New Page
                </button>
                <button class="btn-secondary" id="newSubPageBtn" disabled>
                    <i class="fas fa-level-down-alt"></i> New Subpage
                </button>
                <button class="btn-publish" id="publishBtn" disabled>
                    <i class="fas fa-cloud-upload-alt"></i> Publish to GitHub
                </button>
            </div>

            <div class="sync-status" id="syncStatus">
                <i class="fas fa-circle"></i>
                <span>Changes saved locally</span>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search pages...">
            </div>

            <nav class="page-tree" id="pageTree">
                <!-- Page tree will be populated by JavaScript -->
            </nav>

            <div class="sidebar-footer">
                <a href="edit/" class="btn-icon" title="Rich Text Editor" style="color: inherit; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-pencil-alt"></i>
                </a>
                <button class="btn-icon" id="settingsBtn" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn-icon" id="importExportBtn" title="Import/Export">
                    <i class="fas fa-file-export"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="editor-header">
                <input type="text" id="pageTitle" class="page-title-input" placeholder="Untitled Page">
                <div class="editor-actions">
                    <button class="btn-icon" id="toggleEditMode" title="Toggle Edit/Preview">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon" id="insertLinkBtn" title="Insert Link">
                        <i class="fas fa-link"></i>
                    </button>
                    <button class="btn-icon" id="uploadFileBtn" title="Upload File">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="btn-icon" id="deletePageBtn" title="Delete Page">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn-icon" id="exportPageBtn" title="Export as Markdown">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>

            <div class="editor-container">
                <!-- Edit Mode -->
                <div class="editor-pane" id="editorPane">
                    <textarea id="markdownEditor" placeholder="Start writing in Markdown...

# Heading 1
## Heading 2
### Heading 3

**Bold text**
*Italic text*
- List item
1. Numbered item

[Link text](url)
![Image alt](image-url)

```code block```
"></textarea>
                </div>

                <!-- Preview Mode -->
                <div class="preview-pane" id="previewPane">
                    <div id="markdownPreview" class="markdown-content">
                        <div class="welcome-message">
                            <h1>Welcome to Your Content Manager</h1>
                            <p>Connect to GitHub to sync your content, or start creating pages locally.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Attachments Section -->
            <div class="attachments-section" id="attachmentsSection">
                <h3><i class="fas fa-paperclip"></i> Attachments</h3>
                <div class="attachments-list" id="attachmentsList">
                    <!-- Attachments will be listed here -->
                </div>
            </div>

            <!-- Hidden file input -->
            <input type="file" id="fileInput" style="display: none;" multiple>
        </main>
    </div>

    <!-- Modal for page creation -->
    <div class="modal" id="newPageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Page</h2>
                <button class="btn-icon" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <label for="newPageTitle">Page Title:</label>
                <input type="text" id="newPageTitle" placeholder="Enter page title" autofocus>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelNewPage">Cancel</button>
                <button class="btn-primary" id="confirmNewPage">Create</button>
            </div>
        </div>
    </div>

    <!-- GitHub Settings Modal -->
    <div class="modal" id="githubSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>GitHub Connection Settings</h2>
                <button class="btn-icon" id="closeGithubModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="githubToken">GitHub Personal Access Token:</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxx">
                    <small>Need a token? <a href="https://github.com/settings/tokens/new?scopes=repo&description=Content%20Manager" target="_blank">Create one here</a></small>
                </div>
                <div class="form-group">
                    <label for="githubRepo">Repository (username/repo):</label>
                    <input type="text" id="githubRepo" placeholder="username/repo-name">
                </div>
                <div class="form-group">
                    <label for="githubBranch">Branch:</label>
                    <input type="text" id="githubBranch" placeholder="main" value="main">
                </div>
                <div class="connection-status" id="connectionStatus"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="disconnectGithub">Disconnect</button>
                <button class="btn-primary" id="saveGithubSettings">Connect</button>
            </div>
        </div>
    </div>

    <!-- Insert Link Modal -->
    <div class="modal" id="insertLinkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Insert Link</h2>
                <button class="btn-icon" id="closeLinkModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="linkText">Link Text:</label>
                    <input type="text" id="linkText" placeholder="Click here">
                </div>
                <div class="form-group">
                    <label for="linkUrl">URL:</label>
                    <input type="text" id="linkUrl" placeholder="https://example.com">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLink">Cancel</button>
                <button class="btn-primary" id="confirmLink">Insert</button>
            </div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div class="modal" id="importExportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import/Export Data</h2>
                <button class="btn-icon" id="closeImportExportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <h3>Export</h3>
                <button class="btn-primary" id="exportAllBtn">
                    <i class="fas fa-download"></i> Export All Pages (JSON)
                </button>
                <hr style="margin: 20px 0;">
                <h3>Import</h3>
                <button class="btn-secondary" id="importBtn">
                    <i class="fas fa-upload"></i> Import Pages (JSON)
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p id="loadingText">Loading...</p>
    </div>

    <!-- Shared Storage Module (unified data model) -->
    <script src="shared-storage.js"></script>
    <script src="app.js"></script>
</body>
</html>
